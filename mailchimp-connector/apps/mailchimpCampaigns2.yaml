#!content-type:mailchimpCampaign
#name: mailchimpCampaigns2-app
appClass: info.magnolia.ui.framework.app.BaseApp
icon: icon-content-app
class: info.magnolia.ui.contentapp.configuration.ContentAppDescriptor
label: Mailchimp Campaigns 2

subApps:
  campaigns:
    label: Mailchimp Campaigns
    class: info.magnolia.ui.contentapp.configuration.BrowserDescriptor
    subAppClass: info.magnolia.ui.contentapp.ContentBrowserSubApp
    closable: false
    datasource:
      class: info.magnolia.ui.datasource.jcr.JcrDatasourceDefinition
      workspace: mailchimpCampaign
      includeProperties: true
      allowedNodeTypes:
        - sch:mailchimpCampaign


    workbench:
      contentViews:
#        - name: tree
#          $type: treeView
#          columns:
#            - name: settings.title
#              label: Title
#            - name: settings.subject_line
#              label: Subject
#            - name: settings.from_name
#              label: From Name
#            - name: settings.to_name
#              label: To name
        - name: list
          $type: listView
          columns:
            - name: settings.title
              label: Title
            - name: settings.subject_line
              label: Subject
            - name: settings.from_name
              label: From Name
            - name: settings.to_name
              label: To name
            - name: recipients.list_id
              label: To name

    actionbar:
      # label: Product
      sections:
        root:
          availability:
            root: true
          groups:
            addActions:
              name: addActions
              items:
                - name: addCampaign
            editActions:
              name: editActions
              items:
                - name: editCampaign
                - name: addMailchimpCampaignAction
#        item:
#          availability:
#            root: false
#          groups:
#            editActions:
#              name: editActions
#              items:
#                - name: addMailchimpCampaignAction
    actions:
      addCampaign:
        $type: openDetailSubappAction
        label: Add campaign
        appName: mailchimpCampaigns2
        subAppName: campaignDetail
        viewType: add
        availability:
          root: true
      editCampaign:
        $type: openDetailSubappAction
        label: Edit Campaign
        appName: mailchimpCampaigns2
        subAppName: campaignDetail
        viewType: edit
        availability:
          nodeTypes:
            mailchimpCampaign: sch:mailchimpCampaign
      addMailchimpCampaignAction:
        $type: jsAction
        modelPath: /mailchimp-connector/templates/js/addMailchimpCampaignAction.js
        label: Create Mailchimp Campaign
  #      prepareScheduleCampaign:
  #        $type: openDetailSubappAction
  #        label: View
  #        icon: icon-view
  #        appName: mailchimpCampaigns
  #        subAppName: scheduleCampaign
  #        viewType: edit

  schedule-campaigns:
    label: Schedule Mailchimp campaign
    class: info.magnolia.ui.contentapp.configuration.BrowserDescriptor
    subAppClass: info.magnolia.ui.contentapp.ContentBrowserSubApp
    closable: false
    datasource:
      class: info.magnolia.ui.datasource.jcr.JcrDatasourceDefinition
      workspace: scheduleCampaign
      includeProperties: true
      allowedNodeTypes:
        - sch:scheduleCampaign

#    datasource:
#      $type: jsonDatasource
#      restClient: mailchimpCampaigns
#      restCall: campaigns
#      jsonPathExpressions:
#        itemId: '$.id'
#        items: "$.[*]"
#        describeBy: '$.settings.subject_line'
    workbench:
      contentViews:
        - name: list
          $type: listView
          columns:
            - name: id
              label: Campaign ID
            - name: schedule_time
              label: Schedule Time

    actionbar:
      # label: Product
      sections:
        root:
          availability:
            root: true
          groups:
            addActions:
              name: addActions
              items:
                - name: newScheduleCampaign
            editActions:
              name: editActions
              items:
                - name: editScheduleCampaign
                - name: scheduleMailchimpCampaignAction
#        item:
#          availability:
#            root: false
#          groups:
#            editActions:
#              name: editActions
#              items:
#                - name: scheduleMailchimpCampaignAction
    actions:
      newScheduleCampaign:
        $type: openDetailSubappAction
        label: Add Schedule Campaign
        appName: mailchimpCampaigns2
        subAppName: scheduleCampaignDetail
        viewType: add
        availability:
          root: true
      editScheduleCampaign:
        $type: openDetailSubappAction
        label: Edit Schedule Campaign
        appName: mailchimpCampaigns2
        subAppName: scheduleCampaignDetail
        viewType: edit
        availability:
          nodeTypes:
            mailchimpCampaign: sch:scheduleCampaign
      scheduleMailchimpCampaignAction:
        $type: jsAction
        modelPath: /mailchimp-connector/templates/js/scheduleMailchimpCampaignAction.js
        label: Schedule Campaign
        icon: icon-mail-setting

  campaignDetail:
    label: Add/Edit Campaign
    class: info.magnolia.ui.contentapp.detail.DetailDescriptor
    itemProvider:
      class: info.magnolia.ui.editor.JcrNodeFromLocationResolutionDefinition
      workspace: mailchimpCampaign
      nodeType: sch:mailchimpCampaign
    form:
      properties:
        id:
          label: ID
          $type: textField
          readOnly: true
        list_id:
          label: List
          $type: restComboBoxField
          datasource:
            name: rest
            $type: jsonDatasource
            restClient: mailchimpCampaigns
            restCall: lists
            jsonPathExpressions:
              itemId: '$.id'
              items: '$.lists'
              describeBy: '$.name'
        type:
          required: true
          label: Type
          $type: textField




  scheduleCampaignDetail:
    label: Schedule Campaign
    class: info.magnolia.ui.contentapp.detail.DetailDescriptor
    itemProvider:
      class: info.magnolia.ui.editor.JcrNodeFromLocationResolutionDefinition
      workspace: scheduleCampaign
      nodeType: sch:scheduleCampaign
    form:
      properties:
        id:
          label: Campaign
          $type: restComboBoxField
          datasource:
            name: rest
            $type: jsonDatasource
            restClient: mailchimpCampaigns
            restCall: campaigns
            jsonPathExpressions:
              itemId: '$.id'
              items: '$.campaigns'
              describeBy: '$.settings.title'
        schedule_time:
          label: Schedule Time
          $type: dateField
          time: true

#          readOnly: true
#  scheduleCampaign:
#    label: Schedule Campaign
#    class: info.magnolia.ui.contentapp.detail.DetailDescriptor
#
#    datasource:
#      $type: jsonDatasource
#      restClient: mailchimpCampaigns
#      restCall: campaign
#      jsonPathExpressions:
#        properties:
#          id: $.id
#          title: $.settings.title
#          updatedAt: $.create_time
#      cancel:
#        label: Cancel
#        $type: closeAction
#    itemProvider:
#        $type: jsonProvider
#    form:
#      properties:
#        id:
#          label: ID
#          $type: textField
#        title:
#          label: Title
#          $type: textField
#          readOnly: true
#        scheduleAt:
#          label: Schedule At
#          required: true
#          $type: dateField
#          time: true